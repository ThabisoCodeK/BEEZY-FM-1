<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Beezy FM - Radio Bathong</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<!-- Google Fonts - Inter -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  /* Base body styles: sets font, background, and ensures full viewport height. */
  body {
    font-family: 'Inter', sans-serif;
    background-image: url('image_643d5e.jpg'); /* Ensure this image path is correct */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    margin: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    position: relative; /* Needed for the pseudo-element positioning */
    overflow-y: auto; /* Allows scrolling when content exceeds viewport height */
  }

  /* Overlay for blur effect: Creates a semi-transparent layer over the background image */
  body::before {
    content: "";
    position: fixed; /* Fixed to the viewport */
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(255, 255, 255, 0.2); /* Semi-transparent white overlay */
    backdrop-filter: blur(8px); /* Applies a blur effect */
    -webkit-backdrop-filter: blur(8px); /* Vendor prefix for Safari compatibility */
    z-index: -1; /* Positions the overlay behind the main content */
  }

  /* Station logo styles */
  .station-logo {
    width: 100px;
    height: 100px;
    object-fit: cover;
  }

  /* Station info custom text color for 'BEEZY FM' */
  .station-info h1 {
    color: yellow; /* Custom yellow for heading */
  }

  /* Custom styles for main content containers (replacing previous .container with Bootstrap's .card) */
  .custom-card {
    background-color: rgba(240, 242, 245, 0.9);
    border-radius: 1rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                0 4px 6px -2px rgba(0, 0, 0, 0.05);
    padding: 2.5rem;
    width: 100%;
    max-width: 768px; /* Max width for larger screens */
    margin: 0 auto;
    box-sizing: border-box;
    position: relative;
    border: 1px solid #e2e8f0;
    text-align: center;
  }

  /* Styles for the current show title */
  .show-title {
    color: #eab308; /* Tailwind yellow-500 equivalent */
  }

  /* Presenter info text color */
  .presenter-info p {
    color: #4a5568; /* Tailwind gray-700 equivalent */
  }

  /* Contact lines styling */
  .contact-line-item {
    font-weight: 600;
  }
  .whatsapp-line-item {
    color: #25D366; /* WhatsApp green */
  }
  .studio-line-item {
    color: #1A73E8; /* Google Blue, or similar */
  }
  .whatsapp-icon {
    width: 20px;
    height: 20px;
  }

  /* Progress bar custom styling */
  .progress-bar-container {
    background-color: #e2e8f0;
    border-radius: 9999px;
    height: 0.75rem;
    overflow: visible;
    position: relative;
  }
  .progress-bar-custom { /* Custom class to avoid conflict with Bootstrap's .progress-bar */
    height: 100%;
    background-color: yellow;
    border-radius: 9999px;
    width: 0%;
    transition: width 0.5s ease;
  }
  .time-label {
    position: absolute;
    top: -1.5rem;
    font-size: 0.75rem;
    color: #000;
    font-weight: 600;
    white-space: nowrap;
  }
  .time-label.start { left: 0; }
  .time-label.end { right: 0; }

  /* Live on Air flashing effect */
  @keyframes flashRed {
    0%, 100% { color: #ef4444; }
    50% { color: #b91c1c; }
  }
  .flashing-on-air {
    animation: flashRed 1.15s infinite alternate;
  }

  /* Show image container pulse animation */
  .show-image-container {
    width: 200px;
    height: 200px;
    margin: 0 auto 1.5rem auto;
    position: relative;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 0 0 0 rgba(255, 255, 0, 0.7);
    animation: pulseMagnetic 2s infinite ease-in-out;
  }
  @keyframes pulseMagnetic {
    0% { box-shadow: 0 0 0 0 rgba(255, 255, 0, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(0, 0, 0, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 255, 0, 0); }
  }

  /* Play/Pause button styles */
  .play-pause-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.6);
    border: 2px solid yellow;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.3s ease;
    z-index: 5;
  }
  .play-pause-button:hover {
    background-color: rgba(0, 0, 0, 0.8);
    transform: translate(-50%, -50%) scale(1.1);
  }
  .play-pause-button svg {
    fill: yellow;
    width: 30px;
    height: 30px;
  }

  /* News section weather cards */
  .weather-grid {
    display: flex;
    overflow-x: auto;
    white-space: nowrap;
    gap: 1.5rem;
    padding-bottom: 1rem;
    -ms-overflow-style: none; /* IE and Edge */
    scrollbar-width: none; /* Firefox */
  }
  .weather-grid::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }
  .weather-card {
    flex-shrink: 0;
    width: 280px; /* Fixed width for desktop */
    box-sizing: border-box;
    background-color: rgba(248, 250, 252, 0.95);
    border: 1px solid #e2e8f0;
    border-radius: 0.75rem;
    padding: 1.25rem;
    text-align: center;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03);
    transition: transform 0.2s ease-in-out;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .weather-card:hover {
    transform: translateY(-5px);
  }
  .weather-card.highlight {
    border: 2px solid #eab308;
    box-shadow: 0 0 15px rgba(234, 179, 8, 0.5);
    transform: scale(1.03);
  }
  .weather-card .temp {
    color: #eab308;
  }

  /* Schedule section styles */
  .day-tabs .btn.active {
    background-color: #eab308; /* yellow */
    color: white;
    box-shadow: 0 2px 5px rgba(234, 179, 8, 0.4);
  }

  /* Timeline specific styles */
  .timeline-container {
    position: relative;
    padding-left: 50px; /* Space for the timeline line and dots */
    border-left: 2px solid #eab308; /* The main timeline line */
  }

  .timeline-entry {
    position: relative;
    margin-bottom: 20px;
    padding: 15px 15px 15px 30px; /* Padding for content inside the entry */
    background-color: #f8fafc;
    border-radius: 0.75rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
    text-align: left; /* Align text within entry to left */
    border: 1px solid #e2e8f0;
  }

  .timeline-entry:hover {
    transform: translateY(-3px);
    background-color: #f0f4f8;
  }

  /* Timeline dot */
  .timeline-entry::before {
    content: '';
    position: absolute;
    left: -13px; /* Position the dot on the timeline line */
    top: 25px; /* Adjust vertical alignment */
    width: 20px;
    height: 20px;
    background-color: #eab308; /* Yellow dot */
    border: 3px solid #fff; /* White border around the dot */
    border-radius: 50%;
    z-index: 1;
  }

  /* Live show highlight for timeline entry */
  @keyframes flashScheduleEntry {
    0%, 100% {
      background-color: #fffbeb;
      border-color: #fbbf24;
      box-shadow: 0 4px 8px rgba(251, 191, 36, 0.2);
    }
    50% {
      background-color: #fcd34d;
      border-color: #eab308;
      box-shadow: 0 6px 12px rgba(251, 191, 36, 0.4);
    }
  }
  .timeline-entry.live-show-highlight {
    animation: flashScheduleEntry 1.5s infinite alternate;
  }

  .timeline-time {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1a202c;
    margin-bottom: 0.5rem;
  }

  .timeline-image {
    width: 60px; /* Smaller image for timeline */
    height: 60px;
    object-fit: cover;
    border-radius: 0.5rem;
    border: 2px solid #ccc;
    margin-right: 15px; /* Space between image and text */
    flex-shrink: 0;
  }

  .timeline-details {
    display: flex;
    align-items: center;
    margin-top: 10px;
  }

  .timeline-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #333;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .timeline-presenter {
    font-size: 1rem;
    color: #666;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  /* Responsive Adjustments */
  @media (max-width: 767.98px) { /* Equivalent to Bootstrap's -sm breakpoint */
    /* Adjust header for mobile */
    .navbar-toggler {
      display: block; /* Show toggler on mobile */
      border: none; /* Remove default border */
    }
    .navbar-collapse {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      transition: transform 0.3s ease-in-out;
      transform: translateX(-100%);
      z-index: 999;
    }
    .navbar-collapse.show {
      transform: translateX(0);
    }
    .navbar-nav {
      flex-direction: column;
      align-items: center;
      padding-top: 1rem;
      padding-bottom: 1rem;
    }
    .nav-link {
      padding: 0.5rem 1rem;
      width: 100%;
      text-align: center;
    }
    .volume-control {
      width: 100%;
      justify-content: center;
      margin-top: 1rem;
      margin-left: 0;
    }

    /* Adjust main content padding */
    main {
      padding: 1rem;
      gap: 2rem;
    }

    /* Mobile specific styles for weather grid (schedule is now timeline based) */
    .weather-grid {
      flex-direction: column;
      white-space: normal;
      overflow-x: hidden;
      align-items: center;
      padding-left: 0;
      padding-right: 0;
      gap: 1rem; /* Adjust gap for vertical stacking */
    }

    .weather-card {
      width: 100%; /* Take full width */
      max-width: none;
      margin-bottom: 1rem;
    }
    .weather-grid .weather-card:last-child {
      margin-bottom: 0;
    }

    /* Timeline specific mobile adjustments */
    .timeline-container {
      padding-left: 30px; /* Reduce padding for mobile */
      border-left: 2px solid #eab308;
    }
    .timeline-entry::before {
      left: -11px; /* Adjust dot position for smaller padding */
      top: 20px; /* Adjust vertical alignment */
      width: 16px;
      height: 16px;
      border-width: 2px;
    }
    .timeline-entry {
      padding: 10px 10px 10px 20px;
    }
    .timeline-image {
      width: 50px;
      height: 50px;
      margin-right: 10px;
    }
    .timeline-title {
      font-size: 1.1rem;
    }
    .timeline-presenter {
      font-size: 0.9rem;
    }
  }
</style>
</head>
<body>
<header class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#" onclick="showSection('home-section')">
      <img src="https://proxy.zeno.fm/content/stations/f0ccd091-d7e5-4939-98d8-52457d88ecd3/image/?u=1742924775000" alt="Beezy FM Logo" class="station-logo me-2 rounded-0" />
      <div class="station-info">
        <h1 class="h4 mb-0 fw-bold">BEEZY FM</h1>
        <p class="small text-light mb-0">RADIO BATHONG</p>
      </div>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNavbar">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('home-section')">HOME</a></li>
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('news-section')">BEEZY NEWS</a></li>
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('schedule-section')">BEEZY SCHEDULE</a></li>
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('about-section')">ABOUT US</a></li>
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('contact-section')">CONTACT</a></li>
      </ul>
      <div class="volume-control d-flex align-items-center ms-lg-3">
        <label for="volume-slider" class="visually-hidden">Volume</label>
        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5" class="form-range w-auto" />
        <span id="volume-icon" class="ms-2">üîä</span>
      </div>
    </div>
  </div>
</header>
<main class="d-flex flex-column align-items-center py-4">
  <div class="custom-card mb-5" id="home-section">
    <h1 class="display-6 fw-bold text-dark mb-4 flashing-on-air" id="show-time-top">LIVE ON AIR</h1>
    <div id="show-info" class="p-4 bg-light border border-info rounded shadow-sm">
      <div id="contact-numbers" class="contact-lines mb-3">
          <!-- Contact numbers will be dynamically inserted here by JavaScript -->
      </div>
      <div class="show-image-container">
        <img id="show-image" class="img-fluid show-image" src="https://proxy.zeno.fm/content/stations/f0ccd091-d7e5-4939-98d8-52457d88ecd3/image/?u=1742924775000" alt="Show Image" />
        <button id="play-pause-button" class="play-pause-button" aria-label="Play/Pause Radio Stream">
          <svg id="play-icon" style="display: block;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z"/>
          </svg>
          <svg id="pause-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
          </svg>
        </button>
      </div>
      <p class="h5 mt-3 mb-1 text-dark" id="current-show-duration-display"></p>
      <p class="show-title h3 mb-2" id="show-name">Loading Show...</p>
      <p id="current-song-title" class="lead fw-semibold text-secondary mt-2">No song info</p>
      <p id="current-song-artist" class="text-muted">Artist: </p>
      <div class="presenter-info">
        <p id="presenter-name"></p>
      </div>
      <div class="progress-bar-container mt-4 mb-2">
        <div class="progress-bar-custom" id="show-progress-bar"></div>
        <span class="time-label start" id="show-elapsed-time-label"></span>
        <span class="time-label end" id="show-total-duration-label"></span>
      </div>
      <p class="next-show-info text-warning mt-3" id="next-show-name"></p>
      <p class="next-show-presenter text-secondary" id="next-show-presenter"></p>
    </div>
    <p class="text-muted mt-3" id="current-time"></p>
  </div>

  <div id="news-section" class="custom-card mb-5 d-none">
    <h2 class="h3 fw-bold text-dark mb-4">Beezy News: Weather Updates</h2>
    <div class="weather-grid row justify-content-center g-3" id="weather-updates">
      <p>Loading weather data...</p>
    </div>
    <p class="text-muted mt-3" id="news-last_updated"></p>
  </div>

  <div id="schedule-section" class="custom-card mb-5 d-none">
    <h2 class="h3 fw-bold text-dark mb-4">Beezy FM Broadcast Schedule</h2>
    <div id="day-tabs" class="day-tabs d-flex justify-content-center gap-2 flex-wrap mb-4"></div>
    <div id="daily-schedules-container" class="daily-schedules-container px-3">
      <!-- Schedule content will be dynamically loaded here as a timeline -->
    </div>
  </div>

  <div id="about-section" class="custom-card mb-5 d-none">
    <h2 class="h3 fw-bold text-dark mb-4">Welcome to the New Beezy FM!</h2>
    <p class="listener-count-label lead text-secondary">Our Growing Family:</p>
    <span id="listener-count" class="listener-count-display display-5 fw-bold text-warning d-block mb-4">0</span>
    <p class="lead text-dark">
      Beezy FM is more than just a radio station; we are a vibrant community hub, dedicated to bringing you the freshest beats,
      most insightful discussions, and up-to-the-minute news. Our mission is to connect, entertain, and inform our listeners across South Africa.
    </p>
    <p class="lead text-dark">
      We are constantly innovating to enhance your listening experience. From our dynamic presenters to our diverse music selection,
      every aspect of Beezy FM is crafted with you in mind. Join us as we continue to grow and shape the sound of tomorrow!
    </p>
    <ul class="list-unstyled text-start mx-auto" style="max-width: 400px;">
      <li class="mb-2 ps-4 position-relative"><span class="position-absolute start-0">üéß</span> Cutting-Edge Content: Always relevant, always engaging.</li>
      <li class="mb-2 ps-4 position-relative"><span class="position-absolute start-0">üåç</span> Community Focused: Your voice, your stories, our platform.</li>
      <li class="mb-2 ps-4 position-relative"><span class="position-absolute start-0">üé∂</span> Diverse Music Library: Discover new favorites and timeless classics.</li>
      <li class="mb-2 ps-4 position-relative"><span class="position-absolute start-0">üéôÔ∏è</span> Top Presenters: The best talent bringing you daily joy.</li>
      <li class="mb-2 ps-4 position-relative"><span class="position-absolute start-0">üèÜ</span> Award-Winning Quality: Recognized for our commitment to excellence.</li>
    </ul>
    <p class="text-dark">Thank you for being part of the Beezy FM family. Radio Bathong!</p>
  </div>

  <div id="contact-section" class="custom-card mb-5 d-none">
    <h2 class="h3 fw-bold text-dark mb-4">Contact Beezy FM</h2>
    <p class="lead text-dark">We'd love to hear from you! Reach out to us through the following channels:</p>
    <ul class="list-unstyled text-start mx-auto" style="max-width: 300px;">
      <li class="mb-2 d-flex align-items-center justify-content-center">
        <span class="text-warning fs-5 me-2">üìû</span> Phone: <a href="tel:+27836442822" class="text-primary text-decoration-underline">083 644 2822</a>
      </li>
      <li class="mb-2 d-flex align-items-center justify-content-center">
        <span class="text-success fs-5 me-2">üì±</span> WhatsApp: <a href="https://wa.me/27836442822" target="_blank" class="text-primary text-decoration-underline">083 644 2822</a>
      </li>
      <li class="mb-2 d-flex align-items-center justify-content-center">
        <span class="text-danger fs-5 me-2">üìß</span> Email: <a href="mailto:info@beezyfm.co.za" class="text-primary text-decoration-underline">info@beezyfm.co.za</a>
      </li>
      <li class="mb-2 d-flex align-items-center justify-content-center">
        <span class="text-primary fs-5 me-2">üëç</span> Facebook: <a href="https://www.facebook.com/p/BEEZY-FM-61571015857551/" target="_blank" class="text-primary text-decoration-underline">Beezy FM Page</a>
      </li>
    </ul>
    <p class="mt-4 text-dark">Our offices are open from 8:00 AM to 5:00 PM, Monday to Friday.</p>
  </div>
</main>
<footer class="bg-dark text-light text-center py-3 mt-auto">
  <p class="mb-2 small">&copy; 2025 Beezy FM. All rights reserved. Radio Bathong.</p>
  <div class="social-links">
    <a href="https://www.facebook.com/p/BEEZY-FM-61571015857551/" target="_blank" class="text-warning mx-2 text-decoration-none fw-semibold">Facebook</a> |
    <a href="https://wa.me/0836442822" target="_blank" class="text-warning mx-2 text-decoration-none fw-semibold">Whatsapp</a>
  </div>
</footer>
<audio id="radio-stream" src="https://stream.zeno.fm/f0ccd091-d7e5-4939-98d8-52457d88ecd3/audio" preload="none"></audio>
<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
  // Global variable for interval ID to manage periodic updates.
  let currentShowIntervalId; // Renamed for clarity for the main player updates
  let weatherIntervalId; // For weather updates
  let listenerCountIntervalId; // For listener count animation

  // --- Schedule Data (used for current show logic) ---
  const schedule = {
    sunday: [
      { start: { hour: 6, minute: 0 }, end: { hour: 9, minute: 0 }, name: "SELEKANE", presenter: "TROST WAHA NDUMO" },
      { start: { hour: 9, minute: 0 }, end: { hour: 12, minute: 0 }, name: "EMMANUEL", presenter: "MONYANE MOKOENA" },
      { start: { hour: 12, minute: 0 }, end: { hour: 15, minute: 0 }, name: "IKETLE", presenter: "NKUNYANA NKUNYANA (SKUZABELL)" },
      { start: { hour: 15, minute: 0 }, end: { hour: 18, minute: 0 }, name: "BEEZY CRUISE", presenter: "DIBUSENG PELEHA (QUEEN D)" },
      { start: {hour: 18, minute: 0}, end: {hour: 21, minute: 0}, name: "EBENHEZER", presenter:"LERATO MOKAEANE"},
      { start: {hour: 21, minute: 0}, end: {hour: 0, minute: 0}, name:"DIVINE WORSHIP", presenter:"MALESEDI MOFOKENG" },
      { start: { hour: 0, minute: 0 }, end: { hour: 6, minute: 0, nextDay: false }, name: "AUTOMATED PLAYLIST", presenter: "Automated Playlist" }
    ],
    weekday: [
      { start: { hour: 6, minute: 0 }, end: { hour: 7, minute: 0 }, name: "THAHAMESO", presenter: "MASESI MOLABA" },
      { start: { hour: 7, minute: 0 }, end: { hour: 9, minute: 0 }, name: "MONAKALADI BREAKFAST SHOW", presenter: "JOHANNES LESIBA" },
      { start: { hour: 9, minute: 0 }, end: { hour: 12, minute: 0 }, name: "MAGNIFICENT MORNING", presenter: "PHELEKWA (PEKSH) MPONO" },
      { start: { hour: 12, minute: 0 }, end: { hour: 15, minute: 0 }, name: "MATHULAHOHLE", presenter: "MPHO NTHEBE" },
      { start: { hour: 15, minute: 0 }, end: { hour: 18, minute: 0 }, name: "BEEZY DRIVE with Mo Simela", presenter: "MOHAU SIMELA" },
      { start: { hour: 18, minute: 0 }, end: { hour: 19, minute: 0 }, name: "MAMPODI", presenter: "MASILO MALAKOANE" },
      { start: { hour: 19, minute: 0 }, end: { hour: 20, minute: 0 }, name: "DINALEDI SPORTS SHOW", presenter: "MALEFETSANE MOREKI & MOJALEFA TSOTETSI" },
      { start: { hour: 20, minute: 0 }, end: { hour: 21, minute: 0 }, name: "NOTICE BOARD", presenter: "MOJALEFA ZIM" },
      { start: { hour: 21, minute: 0 }, end: { hour: 0, minute: 0}, name: "CAMPUS CORNER", presenter: "JABULILE HLONGWANE" },
      { start: { hour: 0, minute: 0 }, end: { hour: 6, minute: 0, nextDay: false}, name: "Automated Playlist", presenter: "Automated Playlist" }
    ],
    saturday: [
      { start: { hour: 6, minute: 0 }, end: { hour: 9, minute: 0 }, name: "KA LAPENG", presenter: "MONYANE MOKOENA" },
      { start: { hour: 9, minute: 0 }, end: { hour: 12, minute: 0 }, name: "BEEZY FM TOP 30", presenter: "LEUTSOA NKUNYANA (DJ INCUS)" },
      { start: { hour: 12, minute: 0 }, end: { hour: 15, minute: 0 }, name: "IKETLE", presenter: "NKUNYANA NKUNYANA (SKUZABELL)" },
      { start: { hour: 15, minute: 0 }, end: { hour: 18, minute: 0 }, name: "OLD VIBES", presenter: "SAKI CHELE (DJ SEXY D)" },
      { start: { hour: 18, minute: 0 }, end: { hour: 21, minute: 0 }, name: "TSA MORAOMORAO", presenter: "HANANIOUS MOTAUNG" },
      { start: { hour: 21, minute: 0 }, end: { hour: 0, minute: 0}, name: "HOT ZONE", presenter: "LERATO MOSETHE" },
      { start: { hour: 0, minute: 0 }, end: { hour: 6, minute: 0, nextDay: false}, name: "AUTOMATED PLAYLIST", presenter: "AUTOMATED PLAYLIST" }
    ],
    friday: [
      { start: { hour: 6, minute: 0 }, end: { hour: 7, minute: 0 }, name: "THAHAMESO", presenter: "MASESI MOLABA" },
      { start: { hour: 7, minute: 0 }, end: { hour: 9, minute: 0 }, name: "MONAKALADI BREAKFAST SHOW", presenter: "JOHANNES LESIBA" },
      { start: { hour: 9, minute: 0 }, end: { hour: 12, minute: 0 }, name: "MAGNIFICENT MORNING", presenter: "PHELEKWA (PEKSH) MPONO" },
      { start: { hour: 12, minute: 0 }, end: { hour: 15, minute: 0 }, name: "MATHULAHOHLE", presenter: "MPHO NTHEBE" },
      { start: { hour: 15, minute: 0 }, end: { hour: 18, minute: 0 }, name: "BEEZY DRIVE with Mo Simela", presenter: "MOHAU SIMELA" },
      { start: { hour: 18, minute: 0 }, end: { hour: 19, minute: 0 }, name: "MAMPODI", presenter: "MASILO MALAKOANE" },
      { start: { hour: 19, minute: 0 }, end: { hour: 20, minute: 0 }, name: "DINALEDI SPORTS SHOW", presenter: "MALEFETSANE MOREKI & MOJALEFA TSOTETSI" },
      { start: { hour: 20, minute: 0 }, end: { hour: 21, minute: 0 }, name: "REGGAE HOUR", presenter: "SAKI CHELE (DJ SEXY D)" },
      { start: { hour: 21, minute: 0 }, end: { hour: 0, minute: 0}, name: "HOT ZONE", presenter: "LERATO MOSETHE" },
      { start: { hour: 0, minute: 0 }, end: { hour: 6, minute: 0,nextDay: false}, name: "AUTOMATED PLAYLIST", presenter: "Automated Playlist" }
    ]
  };

  const UNIVERSAL_IMAGE_URL = "https://proxy.zeno.fm/content/stations/f0ccd091-d7e5-4939-98d8-52457d88ecd3/image/?u=1742924775000";
  const ZENO_NOW_PLAYING_API_URL = `https://api.zeno.fm/api/v2/stations/f0ccd091-d7e5-4939-98d8-52457d88ecd3/nowplaying`;

  let currentPlayingSongTitle = "";
  let currentPlayingSongArtist = "";
  let currentPlayingSongId = null;

  async function fetchCurrentSongMetadata() {
    try {
      const response = await fetch(ZENO_NOW_PLAYING_API_URL);
      if (!response.ok) {
        console.warn(`Failed to fetch Zeno.fm metadata: ${response.status} ${response.statusText}`);
        document.getElementById('current-song-title').textContent = "No song info";
        document.getElementById('current-song-artist').textContent = "";
        return;
      }
      const data = await response.json();

      if (data && data.metadata && data.metadata.now_playing) {
        const nowPlaying = data.metadata.now_playing;
        const newTitle = nowPlaying.title || "Unknown Title";
        const newArtist = nowPlaying.artist || "Unknown Artist";
        const newSongId = nowPlaying.song_id || null;
        
        if (newTitle !== currentPlayingSongTitle || newArtist !== currentPlayingSongArtist) {
          currentPlayingSongTitle = newTitle;
          currentPlayingSongArtist = newArtist;
          currentPlayingSongId = newSongId;
          console.log("New Song Playing:", currentPlayingSongTitle, "by", currentPlayingSongArtist);
          
          document.getElementById('current-song-title').textContent = newTitle;
          document.getElementById('current-song-artist').textContent = `Artist: ${newArtist}`;
        }
      } else {
        console.log("Zeno.fm API response does not contain expected 'now_playing' metadata.");
        document.getElementById('current-song-title').textContent = "No song info available";
        document.getElementById('current-song-artist').textContent = "";
        currentPlayingSongTitle = "";
        currentPlayingSongArtist = "";
        currentPlayingSongId = null;
      }
    } catch (error) {
      console.error("Error fetching current song metadata from Zeno.fm:", error);
      document.getElementById('current-song-title').textContent = "Failed to load song info";
      document.getElementById('current-song-artist').textContent = "";
    }
  }

  function formatElapsedTime(seconds) {
    if (isNaN(seconds) || seconds < 0) return "00:00:00";
    const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
    const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
    const s = String(seconds % 60).padStart(2, '0');
    return `${h}:${m}:${s}`;
  }

  function formatTimeAmPm(hour, minute) {
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const formattedHour = hour % 12 === 0 ? 12 : hour % 12;
    const formattedMinute = String(minute).padStart(2, '0');
    return `${formattedHour}:${formattedMinute} ${ampm}`;
  }

  function updateRadioShow() {
    try {
      const now = new Date();
      const day = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday

      document.getElementById('current-time').textContent = `Current Time (SAST): ${now.toLocaleTimeString('en-ZA')} on ${now.toLocaleDateString('en-ZA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`;

      let todaySchedule = [];
      if (day === 5) { // Friday
        todaySchedule = schedule.friday;
      } else if (day >= 1 && day <= 4) { // Monday to Thursday (weekday)
        todaySchedule = schedule.weekday;
      } else if (day === 0) { // Sunday
        todaySchedule = schedule.sunday;
      } else if (day === 6) { // Saturday
        todaySchedule = schedule.saturday;
      }

      let currentShow = null;
      let nextShow = null;
      let currentShowIndex = -1;

      for (let i = 0; i < todaySchedule.length; i++) {
        const show = todaySchedule[i];

        let showStartCandidate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), show.start.hour, show.start.minute);
        let showEndCandidate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), show.end.hour, show.end.minute);

        if (show.end.nextDay || (show.start.hour > show.end.hour || (show.start.hour === show.end.hour && show.start.minute > show.end.minute))) {
            showEndCandidate.setDate(showEndCandidate.getDate() + 1);
        }
        
        if (show.start.hour === 0 && show.start.minute === 0 && show.end.hour === 6) {
          if (now.getHours() >= 0 && now.getHours() < 6 && showStartCandidate.getHours() === 0) {
            showStartCandidate.setDate(showStartCandidate.getDate() - 1);
          }
        }

        if (now >= showStartCandidate && now < showEndCandidate) {
          currentShow = show;
          currentShowIndex = i;
          currentShow.actualStart = showStartCandidate;
          currentShow.actualEnd = showEndCandidate;
          break;
        }
      }

      const showNameEl = document.getElementById('show-name'); // This will be the show TITLE
      const presenterEl = document.getElementById('presenter-name');
      const progressBar = document.getElementById('show-progress-bar');
      const showImage = document.getElementById('show-image');
      const elapsedTimeLabel = document.getElementById('show-elapsed-time-label');
      const totalDurationLabel = document.getElementById('show-total-duration-label');
      const liveOnAirText = document.getElementById('show-time-top'); // This is the H1 that should display "LIVE ON AIR"
      const showDurationDisplay = document.getElementById('current-show-duration-display'); // This will display the show's START-END TIME
      const contactNumbersDiv = document.getElementById('contact-numbers'); // Get the contact numbers div

      // Start with default contact numbers HTML
      let contactHtml = `
          <p class="contact-line-item whatsapp-line-item">
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp Icon" class="whatsapp-icon" />
            WHATSAPP: 083 644 2822
          </p>
          <p class="contact-line-item studio-line-item">
              <span class="text-xl">üìû</span> STUDIO LINE: 068 717 5275
          </p>`;

      if (currentShow) {
        const date = now.getDate();
        // Calculate the week of the month (1-indexed)
        const dayOfMonth = now.getDate();
        const weekOfMonth = Math.ceil(dayOfMonth / 7); // Using Math.ceil to get week 1 for days 1-7, week 2 for days 8-14, etc.

        if (currentShow.name === "DINALEDI SPORTS SHOW") {
          // Changed condition from (weekOfMonth === 1 || weekOfMonth === 3) to (weekOfMonth === 1 || weekOfMonth === 2)
          if (weekOfMonth === 1 || weekOfMonth === 2) {
            currentShow.presenter = "MALEFETSANE MOREKI";
          } else {
            currentShow.presenter = "MOJALEFA TSOTETSI";
          }
        }

        const totalDurationMs = currentShow.actualEnd.getTime() - currentShow.actualStart.getTime();
        const elapsedMs = now.getTime() - currentShow.actualStart.getTime();

        let progressPercent = (elapsedMs / totalDurationMs) * 100;
        if (progressPercent < 0 || isNaN(progressPercent)) progressPercent = 0;
        if (progressPercent > 100) progressPercent = 100;
        progressBar.style.width = progressPercent + '%';

        elapsedTimeLabel.textContent = formatElapsedTime(Math.floor(elapsedMs / 1000));
        totalDurationLabel.textContent = formatElapsedTime(Math.floor(totalDurationMs / 1000));

        const showStartStr = formatTimeAmPm(currentShow.actualStart.getHours(), currentShow.actualStart.getMinutes());
        const showEndStr = formatTimeAmPm(currentShow.actualEnd.getHours(), currentShow.actualEnd.getMinutes());

        // Set "LIVE ON AIR" text and ensure flashing class is present
        liveOnAirText.textContent = "LIVE ON AIR";
        liveOnAirText.classList.add('flashing-on-air');

        // Set show time on the designated element
        showDurationDisplay.textContent = `${showStartStr} - ${showEndStr}`;

        // Set show name
        showNameEl.textContent = currentShow.name;
        presenterEl.textContent = currentShow.presenter ? `Presenter: ${currentShow.presenter}` : '';

        // Conditional contact number for IKETLE on Sunday 12pm-3pm
        if (currentShow.name === "IKETLE" && day === 0 && now.getHours() >= 12 && now.getHours() < 15) {
          contactHtml += `
            <p class="contact-line-item" style="color: #25D366;">
              <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp Icon" class="whatsapp-icon" />
              SKUZABELL BEST 10 SUNDAY SONG REQUEST: 075 174 9408
            </p>
          `;
        }

      } else {
        // When station is off air
        liveOnAirText.textContent = "STATION OFF AIR"; // When no show is live
        liveOnAirText.classList.remove('flashing-on-air'); // Remove flashing when off air

        showDurationDisplay.textContent = "00:00 AM - 00:00 PM"; // Default time when off air
        showNameEl.textContent = "No current show"; // Default show name when off air
        presenterEl.textContent = "";
        progressBar.style.width = '0%';
        elapsedTimeLabel.textContent = "00:00:00";
        totalDurationLabel.textContent = "00:00:00";
        document.getElementById('next-show-name').textContent = "Check schedule for next show.";
        document.getElementById('next-show-presenter').textContent = "";
      }
      
      // Apply the generated contact HTML
      contactNumbersDiv.innerHTML = contactHtml;


      showImage.src = UNIVERSAL_IMAGE_URL;
      showImage.onerror = () => {
        showImage.src = "https://placehold.co/200x200/CCCCCC/666666?text=ERROR";
      };

      if (nextShow) {
        document.getElementById('next-show-name').textContent = `Up Next: ${nextShow.name}`;
        document.getElementById('next-show-presenter').textContent = nextShow.presenter ? `Presenter: ${nextShow.presenter}` : '';
      } else if (currentShow && currentShowIndex === todaySchedule.length - 1) {
        document.getElementById('next-show-name').textContent = "No more shows today. Check schedule for tomorrow.";
        document.getElementById('next-show-presenter').textContent = "";
      }
    } catch (error) {
      console.error("Error in updateRadioShow:", error);
    }
  }

  // --- Volume Control Functionality ---
  const radioStream = document.getElementById('radio-stream');
  const volumeSlider = document.getElementById('volume-slider');
  const volumeIcon = document.getElementById('volume-icon');
  const playPauseButton = document.getElementById('play-pause-button');
  const playIcon = document.getElementById('play-icon');
  const pauseIcon = document.getElementById('pause-icon');

  volumeSlider.addEventListener('input', () => {
    radioStream.volume = volumeSlider.value;
    updateVolumeIcon(radioStream.volume);
  });

  radioStream.volume = volumeSlider.value;
  updateVolumeIcon(radioStream.volume);

  function updateVolumeIcon(volume) {
    if (volume == 0) {
      volumeIcon.textContent = 'üîá';
    } else if (volume < 0.5) {
      volumeIcon.textContent = 'üîà';
    } else {
      volumeIcon.textContent = 'üîä';
    }
  }

  // --- Play/Pause Button Functionality ---
  playPauseButton.addEventListener('click', () => {
    if (radioStream.paused) {
      radioStream.play().catch(e => console.error("Error playing stream:", e));
    } else {
      radioStream.pause();
    }
    updatePlayPauseButtonIcon();
  });

  radioStream.addEventListener('play', updatePlayPauseButtonIcon);
  radioStream.addEventListener('pause', updatePlayPauseButtonIcon);
  radioStream.addEventListener('ended', updatePlayPauseButtonIcon); // Reset when stream ends

  function updatePlayPauseButtonIcon() {
    if (radioStream.paused) {
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
    } else {
      playIcon.style.display = 'none';
      pauseIcon.style.display = 'block';
    }
  }

  // Initial state of the play/pause button
  updatePlayPauseButtonIcon();


  // --- Geolocation and Weather Data Functionality (for Beezy News Section) ---
  const saCities = [
    { name: "Johannesburg", lat: -26.2041, lon: 28.0473 },
    { name: "Cape Town", lat: -33.9249, lon: 18.4241 },
    { name: "Durban", lat: -29.8587, lon: 31.0218 },
    { name: "Pretoria", lat: -25.7479, lon: 28.2293 },
    { name: "Gqeberha", lat: -33.9610, lon: 25.6150 },
    { name: "Bloemfontein", lat: -29.1167, lon: 26.2167 },
    { name: "East London", lat: -33.0178, lon: 27.9116 },
    { name: "Nelspruit", lat: -25.4776, lon: 30.9893 }, // Mbombela
    { name: "Polokwane", lat: -23.9045, lon: 29.4674 },
    { name: "Kimberley", lat: -28.7383, lon: 24.7639 },
    { name: "Pietermaritzburg", lat: -29.6167, lon: 30.3833 },
    { name: "Rustenburg", lat: -25.6589, lon: 27.2407 },
    { name: "George", lat: -33.9610, lon: 22.4604 },
    { name: "Mthatha", lat: -31.5786, lon: 28.7905 },
    { name: "Upington", lat: -28.4500, lon: 21.2500 },
    { name: "Welkom", lat: -27.9715, lon: 26.7329 },
    { name: "Richards Bay", lat: -28.7833, lon: 32.0333 },
    { name: "Mafikeng", lat: -25.8667, lon: 25.6667 }, // Mahikeng
    { name: "Thohoyandou", lat: -22.9467, lon: 30.4700 },
    { name: "Port Shepstone", lat: -30.7333, lon: 30.4500 },
    { name: "Mossel Bay", lat: -34.1833, lon: 22.1333 },
    { name: "Worcester", lat: -33.6500, lon: 19.4500 },
    { name: "Queenstown", lat: -31.9000, lon: 26.8833 },
    { name: "Springbok", lat: -29.6667, lon: 17.8833 },
    { name: "Saldanha", lat: -32.9933, lon: 17.9450 },
    { name: "Langebaan", lat: -33.0800, lon: 18.0400 }
  ];

  const weatherCodeMap = {
    0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
    45: "Fog", 48: "Depositing rime fog",
    51: "Drizzle: Light", 53: "Drizzle: Moderate", 55: "Drizzle: Dense intensity",
    56: "Freezing Drizzle: Light", 57: "Freezing Drizzle: Dense intensity",
    61: "Rain: Slight", 63: "Rain: Moderate", 65: "Rain: Heavy intensity",
    66: "Freezing Rain: Light", 67: "Freezing Rain: Heavy intensity",
    71: "Snow fall: Slight", 73: "Snow fall: Moderate", 75: "Snow fall: Heavy intensity",
    77: "Snow grains",
    80: "Rain showers: Slight", 81: "Rain showers: Moderate", 82: "Rain showers: Violent",
    85: "Snow showers: Slight", 86: "Snow showers: Heavy",
    95: "Thunderstorm: Slight or moderate", 96: "Thunderstorm with slight hail", 99: "Thunderstorm with heavy hail"
  };

  /**
   * Calculates the Haversine distance between two points on Earth (specified by latitudes and longitudes).
   * @param {number} lat1 - Latitude of point 1.
   * @param {number} lon1 - Longitude of point 1.
   * @param {number} lat2 - Latitude of point 2.
   * @param {number} lon2 - Longitude of point 2.
   * @returns {number} Distance in kilometers.
   */
  function haversineDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Radius of Earth in kilometers
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  /**
   * Gets the user's current geographical coordinates.
   * @returns {Promise<{latitude: number, longitude: number}>} A promise that resolves with the user's coordinates.
   */
  function getUserLocation() {
    return new Promise((resolve, reject) => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            resolve({
              latitude: position.coords.latitude,
              longitude: position.coords.longitude
            });
          },
          (error) => {
            console.warn(`Geolocation error (${error.code}): ${error.message}`);
            reject(new Error("Unable to retrieve your location. Please enable location services and grant permission."));
          },
          {
            enableHighAccuracy: false, // Set to false to avoid draining battery unnecessarily
            timeout: 5000,           // 5 seconds timeout
            maximumAge: 60000        // Use cached position if less than 1 minute old
          }
        );
      } else {
        reject(new Error("Geolocation is not supported by your browser."));
      }
    });
  }

  /**
   * Fetches weather updates, prioritizing the user's current location.
   * @param {Object} userCoords - Optional. User's coordinates {latitude, longitude}.
   */
  async function fetchWeatherUpdates(userCoords = null) {
    const container = document.getElementById('weather-updates');
    if (!container) return;
    container.innerHTML = '<p>Loading weather data...</p>';
    const lastUpdatedEl = document.getElementById('news-last_updated');

    let citiesToFetch = [...saCities]; // Create a mutable copy of the cities array
    let closestCityName = null;

    if (userCoords) {
      let minDist = Infinity;
      let closestCityIndex = -1;

      // Find the closest predefined city to the user's location
      saCities.forEach((city, index) => {
        const dist = haversineDistance(userCoords.latitude, userCoords.longitude, city.lat, city.lon);
        if (dist < minDist) {
          minDist = dist;
          closestCityIndex = index;
        }
      });

      if (closestCityIndex !== -1) {
        const closestCity = saCities[closestCityIndex];
        closestCityName = closestCity.name;
        // Move the closest city to the beginning of the array for prioritized display
        citiesToFetch.splice(closestCityIndex, 1);
        citiesToFetch.unshift(closestCity);
        console.log(`User is closest to: ${closestCityName}`);
      }
    }

    try {
      let html = '';
      const fetchPromises = citiesToFetch.map(async city => {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true&timezone=auto`;
        const res = await fetch(url);
        if (!res.ok) {
          throw new Error(`Error fetching weather for ${city.name}: ${res.statusText}`);
        }
        const data = await res.json();
        const current = data.current_weather;
        const temperature = current.temperature;
        const windSpeed = current.windspeed;
        const weatherCode = current.weathercode;
        const weatherDesc = weatherCodeMap[weatherCode] || 'N/A';

        // Add highlight class if this is the closest city
        const highlightClass = (city.name === closestCityName && userCoords) ? 'highlight' : '';

        // Use Bootstrap card classes for weather cards
        return `
          <div class="col-12 col-md-4 mb-3"> <!-- Bootstrap grid column -->
            <div class="card h-100 ${highlightClass} weather-card" data-city-name="${city.name}">
              <div class="card-body">
                <h3 class="card-title h5">${city.name}</h3>
                <p class="card-text">${weatherDesc}</p>
                <p class="card-text fs-4 fw-bold temp">${Math.round(temperature)}¬∞C</p>
                <p class="card-text small text-muted">Wind: ${Math.round(windSpeed)} m/s</p>
              </div>
            </div>
          </div>`;
      });

      const results = await Promise.allSettled(fetchPromises);
      container.innerHTML = ''; // Clear "Loading weather data..."
      results.forEach(result => {
        if (result.status === 'fulfilled') {
          container.innerHTML += result.value;
        } else {
          console.error("Failed to fetch weather for a city:", result.reason);
        }
      });

      if (container.innerHTML === '') {
        container.innerHTML = `<p class="text-danger">No weather data could be loaded for any city. Please check your internet connection or try again later.</p>`;
      } else {
        // If a closest city was found, scroll to it (handled by CSS now due to flex-direction column)
      }
      lastUpdatedEl.textContent = `Weather data last updated: ${new Date().toLocaleTimeString('en-ZA')}`;
    } catch (err) {
      console.error("Overall error fetching weather data:", err);
      container.innerHTML = `<p class="text-danger">Failed to load weather data. An unexpected error occurred.</p>`;
      lastUpdatedEl.textContent = '';
    }
  }

  // --- Listener Count Animation Functionality (for About Us Section) ---
  let listenerCountInterval = null;
  let currentListenerCount = 0;
  const targetListenerCount = 69000;
  const animationDuration = 3000;
  const updateInterval = 50;
  const increment = (targetListenerCount / animationDuration) * updateInterval;

  function startListenerCountAnimation() {
    const listenerCountEl = document.getElementById('listener-count');
    if (!listenerCountEl) return;
    currentListenerCount = 0;
    listenerCountEl.textContent = '0';

    if (listenerCountInterval) {
      clearInterval(listenerCountInterval);
    }

    listenerCountInterval = setInterval(() => {
      currentListenerCount += increment;
      if (currentListenerCount >= targetListenerCount) {
        currentListenerCount = targetListenerCount;
        clearInterval(listenerCountInterval);
        listenerCountInterval = null;
        listenerCountEl.textContent = currentListenerCount.toLocaleString() + '+';
      } else {
        listenerCountEl.textContent = Math.floor(currentListenerCount).toLocaleString();
      }
    }, updateInterval);
  }

  // --- Schedule Generation Functionality (for Beezy Schedule Section) ---
  const daysConfig = [
    { id: "mon-thu", label: "Mon-Thu", scheduleKey: "weekday", dayIndices: [1,2,3,4] },
    { id: "friday", label: "Friday", scheduleKey: "friday", dayIndices: [5] },
    { id: "saturday", label: "Saturday", scheduleKey: "saturday", dayIndices: [6] },
    { id: "sunday", label: "Sunday", scheduleKey: "sunday", dayIndices: [0] }
  ];

  function generateSchedule() {
    const dayTabsContainer = document.getElementById('day-tabs');
    const dailySchedulesContainer = document.getElementById('daily-schedules-container');
    if (!dayTabsContainer || !dailySchedulesContainer) return;

    dayTabsContainer.innerHTML = '';
    dailySchedulesContainer.innerHTML = '';

    const now = new Date();
    const currentDayIndex = now.getDay();
    let activeDayId = '';

    daysConfig.forEach(dayInfo => {
      const btn = document.createElement('button');
      btn.textContent = dayInfo.label;
      btn.className = 'btn btn-secondary'; // Bootstrap button class
      btn.onclick = () => showDaySchedule(dayInfo.id);
      dayTabsContainer.appendChild(btn);

      const dayDiv = document.createElement('div');
      dayDiv.id = `schedule-${dayInfo.id}`;
      dayDiv.className = 'timeline-container'; // Use timeline-container for each day's schedule
      dayDiv.style.display = 'none'; // Initially hidden

      const daySchedule = schedule[dayInfo.scheduleKey];
      if (daySchedule && daySchedule.length > 0) {
        daySchedule.forEach(show => {
          const showStart = new Date(now.getFullYear(), now.getMonth(), now.getDate(), show.start.hour, show.start.minute);
          let showEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), show.end.hour, show.end.minute);

          if (show.end.nextDay || (show.start.hour > show.end.hour || (show.start.hour === show.end.hour && show.start.minute > show.end.minute))) {
            showEnd.setDate(showEnd.getDate() + 1);
          }
          if (show.start.hour === 0 && show.start.minute === 0 && show.end.hour === 6) {
            showStart.setDate(showStart.getDate() - 1);
          }

          const isLive = dayInfo.dayIndices.includes(currentDayIndex) && (now >= showStart && now < showEnd);
          const liveClass = isLive ? 'live-show-highlight' : '';
          const presenterHtml = show.presenter ? `<p class="timeline-presenter mb-0">${show.presenter}</p>` : '';

          dayDiv.innerHTML += `
            <div class="timeline-entry ${liveClass}">
              <div class="timeline-time">
                ${show.start.hour.toString().padStart(2,'0')}:${show.start.minute.toString().padStart(2,'0')} - ${show.end.hour.toString().padStart(2,'0')}:${show.end.minute.toString().padStart(2,'0')}
              </div>
              <div class="timeline-details d-flex align-items-center">
                <img src="${UNIVERSAL_IMAGE_URL}" alt="${show.name}" class="timeline-image me-3"/>
                <div>
                  <h4 class="timeline-title mb-1">${show.name}</h4>
                  ${presenterHtml}
                </div>
              </div>
            </div>
          `;
          if (isLive) {
            activeDayId = dayInfo.id;
          }
        });
      } else {
        dayDiv.innerHTML = '<p class="text-center w-100 py-4 text-muted">No shows scheduled for this day.</p>';
      }
      dailySchedulesContainer.appendChild(dayDiv);
    });

    if (!activeDayId) {
      const todayConfig = daysConfig.find(d => d.dayIndices.includes(currentDayIndex));
      activeDayId = todayConfig ? todayConfig.id : daysConfig[0].id;
    }
    showDaySchedule(activeDayId);
  }

  function showDaySchedule(dayId) {
    document.querySelectorAll('.timeline-container').forEach(d => d.style.display = 'none');
    document.querySelectorAll('.day-tabs button').forEach(b => b.classList.remove('active', 'btn-warning')); // Remove btn-warning and active from all
    document.querySelectorAll('.day-tabs button').forEach(b => b.classList.add('btn-secondary')); // Ensure all are secondary

    const selectedDiv = document.getElementById(`schedule-${dayId}`);
    if (selectedDiv) {
      selectedDiv.style.display = 'block'; // Display as block for timeline
      // Find the currently live show and scroll to it if it exists
      const liveShowElement = selectedDiv.querySelector('.live-show-highlight');
      if (liveShowElement) {
        liveShowElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } else {
        selectedDiv.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top if no live show
      }
    }
    const activeButton = document.querySelector(`.day-tabs button[onclick="showDaySchedule('${dayId}')"]`);
    if(activeButton) {
      activeButton.classList.remove('btn-secondary');
      activeButton.classList.add('active', 'btn-warning'); // Add active and btn-warning to selected
    }
  }

  // --- Section Switching Functionality ---
  let activeSectionId = 'home-section'; // Keep track of the currently active section

  function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('main > .custom-card').forEach(section => { // Use custom-card as selector
      section.classList.add('d-none'); // Bootstrap hidden class
    });

    // Show the requested section
    const targetElement = document.getElementById(sectionId);
    if (targetElement) {
      targetElement.classList.remove('d-none'); // Show section
      activeSectionId = sectionId; // Update active section ID

      // Scroll to the top of the displayed section
      targetElement.scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });

      // Execute section-specific initialization/updates
      if (sectionId === 'news-section') {
        getUserLocation()
          .then(coords => fetchWeatherUpdates(coords))
          .catch(error => {
            console.warn("Geolocation failed, fetching weather for all cities:", error.message);
            fetchWeatherUpdates();
            const container = document.getElementById('weather-updates');
            if (container) {
              container.insertAdjacentHTML('afterbegin', `<p class="text-danger mb-2">Note: ${error.message}</p>`); // Bootstrap danger text
            }
          });
        if (weatherIntervalId) clearInterval(weatherIntervalId);
        weatherIntervalId = setInterval(() => {
          getUserLocation()
            .then(coords => fetchWeatherUpdates(coords))
            .catch(error => {
              console.warn("Periodic geolocation failed, refreshing weather for all cities:", error.message);
              fetchWeatherUpdates();
            });
        }, 600000); // 10 minutes
      } else {
        if (weatherIntervalId) clearInterval(weatherIntervalId);
      }

      if (sectionId === 'about-section') {
        startListenerCountAnimation();
        if (listenerCountIntervalId) clearInterval(listenerCountIntervalId);
      } else {
        if (listenerCountIntervalId) clearInterval(listenerCountIntervalId);
      }

      if (sectionId === 'schedule-section') {
        generateSchedule();
      }
    }

    // Close the mobile navigation menu if it is open
    const mainNavbar = document.getElementById('mainNavbar');
    const bsCollapse = bootstrap.Collapse.getInstance(mainNavbar); // Get Bootstrap Collapse instance
    if (mainNavbar.classList.contains('show')) { // Check if Bootstrap collapse is open
      bsCollapse.hide(); // Hide it using Bootstrap's JS method
    }
  }

  // --- Initial Load Operations ---
  document.addEventListener('DOMContentLoaded', () => {
    fetchCurrentSongMetadata();
    setInterval(fetchCurrentSongMetadata, 10000);

    updateRadioShow();
    currentShowIntervalId = setInterval(updateRadioShow, 1000);

    // Initially show only the home section
    showSection('home-section');
  });
</script>
</body>
</html>
